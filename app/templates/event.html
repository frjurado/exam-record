<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{{ event.discipline.name }} - {{ event.region.name }} - {{ event.year }} | Exam Record</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body class="bg-gray-50 min-h-screen">

    <div class="max-w-4xl mx-auto py-10 px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="mb-8 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">{{ event.discipline.name }}</h1>
                <p class="text-xl text-gray-600">{{ event.region.name }} {{ event.year }}</p>
            </div>
            <a href="/exams/{{ region_slug }}/{{ discipline_slug }}/{{ year }}/contribute"
                class="bg-blue-600 text-white px-4 py-2 rounded shadow hover:bg-blue-700 transition">
                Contribute / Vote
            </a>
        </div>

        <!-- Consensus Banner -->
        {% if event_status != 'empty' %}
        <div class="mb-8 rounded-lg p-4 border shadow-sm flex items-start gap-3
            {% if event_status == 'resolved' %} bg-green-50 border-green-200 text-green-800
            {% elif event_status == 'disputed' %} bg-orange-50 border-orange-200 text-orange-800
            {% else %} bg-gray-100 border-gray-200 text-gray-700 {% endif %}">

            <div class="mt-1">
                {% if event_status == 'resolved' %}
                <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                        clip-rule="evenodd" />
                </svg>
                {% elif event_status == 'disputed' %}
                <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                        clip-rule="evenodd" />
                </svg>
                {% else %}
                <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                        clip-rule="evenodd" />
                </svg>
                {% endif %}
            </div>

            <div>
                <h3 class="font-bold text-lg">
                    {% if event_status == 'resolved' %}Verified by students.
                    {% elif event_status == 'disputed' %}Conflicting reports. Please check details.
                    {% else %}Single source for this exam.{% endif %}
                </h3>
                <p class="text-sm opacity-90">
                    {% if event_status == 'resolved' %}There is high community agreement on this work.{% endif %}
                    {% if event_status == 'disputed' %}Multiple works have been reported. Please help us verify the
                    correct one.{% endif %}
                    {% if event_status == 'neutral' %}Waiting for confirmation from other students.{% endif %}
                </p>
            </div>
        </div>
        {% endif %}

        <!-- Works List -->
        <div class="space-y-4">

            <!-- Resolved View: Show Winner Prominently -->
            {% if event_status == 'resolved' %}
            {% for item in works %}
            {% if item.status == 'verified' %}
            <div
                class="bg-white p-6 rounded-lg shadow-md border border-green-200 ring-2 ring-green-100 flex justify-between items-center">
                <div class="flex-1">
                    <h2 class="text-2xl font-bold text-gray-800">
                        {{ item.work.title }}
                        {% if item.work.nickname %}
                        <span class="text-gray-500 font-normal italic">("{{ item.work.nickname }}")</span>
                        {% endif %}
                    </h2>
                    <p class="text-lg text-gray-700">{{ item.composer.name }}</p>
                    <div class="mt-2 text-sm text-green-700 font-medium">
                        {{ item.votes }} verified votes ({{ item.percentage }}% match)
                    </div>
                </div>
                <div class="ml-4">
                    <span
                        class="inline-flex items-center px-4 py-2 rounded-full text-base font-bold bg-green-100 text-green-800">
                        <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                clip-rule="evenodd" />
                        </svg>
                        Correct Entry
                    </span>
                </div>
            </div>
            {% endif %}
            {% endfor %}

            <!-- Disclosure for specific others -->
            {% set other_works_count = works|length - 1 %}
            {% if other_works_count > 0 %}
            <div x-data="{ open: false }" class="mt-6 border-t pt-4">
                <button @click="open = !open"
                    class="flex items-center text-gray-500 hover:text-gray-700 text-sm font-medium focus:outline-none">
                    <svg class="h-4 w-4 mr-1 transform transition-transform" :class="{'rotate-90': open}" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                    See {{ other_works_count }} other reported option(s) (low confidence)
                </button>

                <div x-show="open" class="mt-4 space-y-3 pl-4 border-l-2 border-gray-100" style="display: none;">
                    {% for item in works %}
                    {% if item.status != 'verified' %}
                    <div class="bg-gray-50 p-4 rounded border border-gray-200 opacity-75">
                        <h3 class="font-bold text-gray-700">{{ item.work.title }}</h3>
                        <p class="text-sm text-gray-600">{{ item.composer.name }}</p>
                        <p class="text-xs text-gray-500 mt-1">{{ item.votes }} vote(s) ({{ item.percentage }}%)</p>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Disputed / Neutral / Empty View: Standard List -->
            {% else %}
            {% for item in works %}
            <div
                class="bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition flex justify-between items-center 
                     {% if event_status == 'disputed' %}border-orange-300 bg-orange-50{% else %}border-gray-200{% endif %}">

                <div class="flex-1">
                    <h2 class="text-xl font-bold text-gray-800">
                        {{ item.work.title }}
                        {% if item.work.nickname %}
                        <span class="text-gray-500 font-normal italic">("{{ item.work.nickname }}")</span>
                        {% endif %}
                    </h2>
                    <p class="text-gray-600">{{ item.composer.name }}</p>

                    <!-- Vote Details for Disputed -->
                    {% if event_status == 'disputed' %}
                    <div class="mt-2 text-sm font-medium text-orange-800">
                        {{ item.votes }} vote(s) ({{ item.percentage }}%)
                    </div>
                    {% endif %}
                    <!-- Vote Details for Neutral -->
                    {% if event_status == 'neutral' %}
                    <div class="mt-2 text-sm text-gray-500 italic">
                        Reported 1 time.
                    </div>
                    {% endif %}
                </div>
            </div>
            {% else %}
            <div class="text-center py-10 text-gray-500">
                <p class="mb-2">No reports found for this exam event yet.</p>
                <a href="/exams/{{ region_slug }}/{{ discipline_slug }}/{{ year }}/contribute"
                    class="text-blue-600 underline font-medium">
                    Be the first to contribute!
                </a>
            </div>
            {% endfor %}
            {% endif %}

        </div>

    </div>
</body>

</html>