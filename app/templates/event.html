{% extends "base.html" %}

{% block title %}{{ event.discipline.name }} - {{ event.region.name }} - {{ event.year }} | Exam Record{% endblock %}

{% block description %}Vote and verify the work performed for the {{ event.year }} {{ event.discipline.name }} exam in
{{ event.region.name }}. See current consensus and contribute.{% endblock %}

{% block content %}
<!-- Header -->
<div class="mb-8 border-b pb-4">
    <h1 class="text-3xl font-bold text-gray-900">{{ event.discipline.name }}</h1>
    <p class="text-xl text-gray-600">{{ event.region.name }} {{ event.year }}</p>
</div>

<!-- Consensus Banner -->
{% include 'partials/event_status_banner.html' %}

<!-- Works List -->
<div class="space-y-4">

    <!-- Resolved View: Show Winner Prominently -->
    {% if event_status == 'resolved' %}
    {% for item in works %}
    {% if item.status == 'verified' %}
    {% include 'partials/work_card.html' %}
    {% endif %}
    {% endfor %}

    <!-- Disclosure for specific others -->
    {% set other_works_count = works|length - 1 %}
    {% if other_works_count > 0 %}
    <div x-data="{ open: false }" class="mt-6 border-t pt-4">
        <button @click="open = !open"
            class="flex items-center text-gray-500 hover:text-gray-700 text-sm font-medium focus:outline-none">
            <svg class="h-4 w-4 mr-1 transform transition-transform" :class="{'rotate-90': open}" fill="none"
                viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
            See {{ other_works_count }} other reported option(s) (low confidence)
        </button>

        <div x-show="open" class="mt-4 space-y-3 pl-4 border-l-2 border-gray-100" style="display: none;">
            {% for item in works %}
            {% if item.status != 'verified' %}
            {% include 'partials/work_card.html' %}
            {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Disputed / Neutral / Empty View: Standard List -->
    {% else %}
    {% for item in works %}
    {% include 'partials/work_card.html' %}
    {% else %}
    <div class="text-center py-10 text-gray-500">
        <p class="mb-2">No reports found for this exam event yet.</p>
        <a href="/exams/{{ region_slug }}/{{ discipline_slug }}/{{ year }}/contribute"
            class="text-blue-600 underline font-medium">
            Be the first to contribute!
        </a>
    </div>
    {% endfor %}
    {% endif %}

</div>

<!-- Contribute Button at Bottom -->
<div class="mt-12 text-center border-t pt-8">
    <h3 class="text-lg font-medium text-gray-900 mb-4">Don't see your piece?</h3>
    <a href="/exams/{{ region_slug }}/{{ discipline_slug }}/{{ year }}/contribute"
        class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 shadow-sm transition">
        Contribute a different work
    </a>
</div>
{% endblock %}